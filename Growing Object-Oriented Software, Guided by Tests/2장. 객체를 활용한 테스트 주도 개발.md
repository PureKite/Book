# 객체를 활용한 테스트 주도 개발

## 1. 객체망
- 객체 지향 설계는 객체 자체보다 객체 간의 의사소통에 집중
  - 객체는 다르객체와 메시지를 주고받으면서 반응
- 객체 지향 시스템은 협업하는 객체의 망으로 구성
  - 시스템의 행위는 객체의 조합을 통해 나타나는 특성
- 시스템에 포함된 객체의 구성을 변경해 시스템 작동 방식을 바꿀 수 있음
  - 객체 구성을 관리할 목적으로 작성한느 코드를 객체망의 행위에 대한 선언적 정의

## 2. 값과 객체
- 시스템을 설계할 때는 값(value)과 객체(object)를 구분하는 것이 중요
  - 값? 변하지 않는 양이나 크기
  - 객체? 시간이 지남에 따라 상태가 변할지도 모르지만 식별자가 있는 계산 절차
  - 객체 지향에서는 두 개념을 모두 클래스라는 동일한 언어 구성물로 구현
- 값은 양이 고정된 불변 인스턴스
  - 값은 개별적인 식별자가 없으므로 두 값 인스턴스의 상태가 같다면 동일한 셈
    - 두 값의 식별자를 비교하는 것은 적절하지 않음 => 미묘한 버그가 생길 수 있음
- 객체는 변경 가능한 상태를 이용해 시간의 추이에 따른 객체의 행위를 나타냄
  - 타입이 똑같은 두 객체는 현재 상태가 정확히 동일하더라도 별개의 식별자를 지님
- 현장에서는 시스템을 두 가지 '진영으로 나눔'
  - 기능적으로 다루는 값과 시스템에서 상태를 지닌 행위를 구현하는 객체

## 3. 메시지를 따르라
- 의사소통 패턴? 
  - 객체들이 다른 객체와 상호 작용하는 방법을 관장하는 각종 규칙
    - 규칙에는 객체의 역할, 객체에서 전달 가능한 메시지와 전달 가능한 시점 등
    - 자바는 (구상) 클래스 대신 (추상) 인터페이스를 이용해 객체의 역할을 파악
- 도메인 모델이 의사소통 패턴에 속함

## 4. 묻지 말고 말하라
- 디미터의 법칙(Law of Demeter)
- 객체는 그것이 내부적으로 보유하고 있거나 메시지를 통해 확보한 정보만 가지고 의사결정을 내려야 함
- 객체는 다른 객체를 탐색해 뭔가를 일어나게 해서는 안 됨
- 이 규칙 덕분에 접근자 메서드가 연이어 호출되도록 암시적으로 두기보다는 객체 간의 상호 작용을 명시적으로 만들고 거기에 이름을 부여하게 됨

## 5. 그래도 가끔은 물어라
- 값과 컬렉션으로부터 정보를 가져오거나 팩터리를 이용해 새 객체를 생성할 때는 '묻는다'
- 예 : 열차 전복
  ```java
  public class Train{
    private final List<Carraige> carriages[...]
    private int percentReservedBarrier = 70;
  
    public void reserveSeats(ReservationRequest request){
        for(Carriage carriage : carriages){
            if(carriage.getSeats().getPercentReserved() < percentReservedBarrier){
                request.reserveSeatsIn(carriage);
                return;
            }
        }
        request.cannotFindSeats();
    }
  }
  ```
  - Carraige의 내부 구조를 노출해서는 안 됨
  - 도움이 되는 정보를 묻기보다는 진정 답하고자 하는 질문을 던져야 함
- 예 수정
  ```java
  public class Train{
    private final List<Carraige> carriages[...]
    private int percentReservedBarrier = 70;
  
    public void reserveSeats(ReservationRequest request){
        for(Carriage carriage : carriages){
            if(carriage.hasSeatsAvailableWithin(percentReservedBarrier)){
                request.reserveSeatsIn(carriage);
                return;
            }
        }
        request.cannotFindSeats();
    }
  }
  ```
  - 질의 메서드를 추가하면 가장 적절한 객체에 행위가 자리 잡아 행위에 이해하기 쉬운 이름이 생기고 테스트하기가 쉬워짐
- 구현이 아니라 호출하는 객체의 의도를 서술하는 질의를 작성하려고 애써야 함
  - 질의가 정보를 객체 바깥으로 새어 나가게해서 시스템을 약간 더 경직되게 만들 수 있기 때문

## 6. 협력 객체의 단위 테스트
- 테스트에 존재하는 대상 객체의 이웃을 다른 대체물, 즉 목 객체(mock object)로 대체하는 것
  - 발생하는 이벤트에 대해 대상 객체가 가짜 이웃과 어떻게 상호 작용할지 지정할 수 있음
    - 예상 구문(expectation)이라 함
  - 테스트가 진행되는 동안 목 객체는 자신이 예상대로 호출됐는지 단정함
- 인터페이스 발견
  - 테스트를 이용하면 객체에 필요한 보조 역할을 파악하는데 도움이 됨
  - 이러한 보조 역할은 자바 인터페이스로 정의돼 있고 시스템의 나머지 부분을 개발할 때 실제 구현처럼 동작

## 7. 목 객체를 활용한 TDD 지원
- 테스트의 핵심 구조
  - 필요한 목 객체 생성
  - 대상 객체를 포함한 실제 객체 생성
  - 대상 객체에서 목 객체가 어떻게 호출될지 예상하는 바를 기술
  - 대상 객체에서 유발(trigger) 메서드(하나 또는 여러 개) 호출
  - 결과 값이 유효하고 예상되는 메서드 호출이 모두 일어났는지 확인
- 단위 테스트는 대상 객체와 해당 객체를 둘러싼 환경 간의 관계를 명확히 드러냄